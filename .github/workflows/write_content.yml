## Workflow: Write Content
## Purpose: Generates localization files from translated content and commits them to the repository.
## Steps:
## 1. Checkout the repository using `actions/checkout@v3`.
## 2. Download the 'translations' artifact using `actions/download-artifact@v3`.
## 3. Set up the Node.js environment (version 18.x).
## 4. Run `scripts/write_localizations.js` to create localization files.
## 5. Configure Git with the GitHub actor's user information.
## 6. Commit and push the changes to the `main` branch.

name: Write Content

on:
  workflow_call:

permissions:
  contents: write  # Grants write permission to push changes

jobs:
  write_content_job:
    runs-on: ubuntu-latest  # Specifies the runner environment

    steps:
      # Step 1: Checkout the repository to access the latest codebase
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Download the translations artifact generated by the previous workflow
      - name: Download translations artifact
        uses: actions/download-artifact@v3
        with:
          name: translations  # Name of the artifact to download
          path: ./artifacts    # Directory where the artifact will be saved

      # Note: The artifact is automatically extracted. No need for manual extraction.

      # Step 3: Set up Node.js environment required for running the localization script
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'  # Specifies the Node.js version to use

      # Step 4: Create localization files using the downloaded translations
      - name: Create localization files
        run: |
          node scripts/write_localizations.js ./artifacts/translations.json
        # Executes the Node.js script to generate localization files from translations

      # Step 5: Configure Git with the GitHub Actions user information for committing changes
      - name: Configure Git
        run: |
          git config --global user.name "${{ github.actor }}"  # Sets the Git username
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"  # Sets the Git email

      # Step 6: Commit and push the updated localization files to the main branch
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: 'Update localization files via GitHub Actions'  # Commit message describing the changes
          branch: main  # Specifies the branch to push changes to
          file_pattern: 'Sources/Babel/Resources/**'  # Defines the file pattern to include in the commit
