## Purpose: Sends a notification to Slack upon completion of the other jobs.
## Verification:
## Workflow File: The notify_slack.yml uses the 8398a7/action-slack@v3 action to send messages to Slack.

## This workflow performs the following steps:
## Defines Inputs: It accepts four inputs when the workflow is called:
## - num_of_languages: The count of languages translated.
## - tokens_count_used: The number of OpenAI tokens used.
## - unit_test_success: A boolean flag indicating if unit tests were successful.
## - slack_webhook: The Slack webhook URL to send the notification.
## Sends Slack Notification: It uses the `8398a7/action-slack@v3` action to send a notification to your Slack channel with the provided details.
## Note: Ensure that you have the correct Slack webhook URL when invoking this workflow.

name: Notify Slack

on:
  workflow_call:
    inputs:
      num_of_languages:
        description: 'Number of languages translated'
        required: true
        type: string
      tokens_count_used:
        description: 'Number of OpenAI tokens used in translation'
        required: true
        type: string
      unit_test_success:
        description: 'Unit test success flag'
        required: true
        type: boolean

jobs:
  send_slack_notification:
    runs-on: ubuntu-latest
    steps:
      ## 1. Check if secret is available
      - name: Ensure SLACK_WEBHOOK_URL is set
        run: |
          if [ -z "$SLACK_WEBHOOK_URL" ]; then
            echo "::error::SLACK_WEBHOOK_URL secret is not set."
            exit 1
          else
            echo "SLACK_WEBHOOK_URL secret is available."
          fi
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      ## 2. Send notification to Slack
      - name: Send Slack notification
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: |
            Babel translation complete.
            Number of languages translated: ${{ inputs.num_of_languages }}
            Tokens used: ${{ inputs.tokens_count_used }} OpenAI tokens
            Testing completed: ${{ inputs.unit_test_success }}
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        if: always() # Ensure the notification is sent even if the job fails or is canceled.

## send slack-channel a notification
## get num_of_languages count from init params
## get tokens_count_used in translation from init params 
## get unit_test_success bool flag from init params
## send payload to slack with:
## "Babel translation complete. num_of_languages was translated. tokens_count_used openAI tokens was used. Testing completed: unit_test_success"

### we need unit_test_success, tokens_count_used, num_of_languages, slack_webhook